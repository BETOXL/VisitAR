"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4948],{4948:(Y,b,c)=>{c.r(b),c.d(b,{MisencuestasPageModule:()=>N});var C=c(6895),v=c(4719),i=c(1558),_=c(2905),d=c(5861),M=c(5670),t=c(6353),Z=c(617),y=c(7556),x=c(1098);function E(n,l){1&n&&(t.TgZ(0,"ion-thumbnail",2),t._UZ(1,"img",25),t.qZA())}function T(n,l){1&n&&(t.TgZ(0,"ion-thumbnail",2),t._UZ(1,"img",26),t.qZA())}function I(n,l){if(1&n&&(t.TgZ(0,"ion-item",22),t.YNc(1,E,2,0,"ion-thumbnail",23),t.YNc(2,T,2,0,"ion-thumbnail",23),t.TgZ(3,"ion-label",24)(4,"h3"),t._uU(5),t.qZA(),t.TgZ(6,"p"),t._uU(7),t.qZA()()()),2&n){const e=t.oxw(),s=e.$implicit,a=e.index;t.xp6(1),t.Q6J("ngIf",!(null!=s&&s.Enviado)),t.xp6(1),t.Q6J("ngIf",null==s?null:s.Enviado),t.xp6(3),t.lnq("N",a," Id:",null==s?null:s.IdCampania_data," - Identi: ",null==s?null:s.Identificador,""),t.xp6(2),t.AsE("",null==s?null:s.Descripcion," - Fecha: ",null==s?null:s.Fecha,"")}}function S(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"div",20),t.NdJ("click",function(){const o=t.CHM(e).$implicit,u=t.oxw();return t.KtG(u.editarEncuesta(o.IdCampania_data))}),t.YNc(1,I,8,7,"ion-item",21),t.qZA()}if(2&n){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",(null==e.filterCoints?null:e.filterCoints.length)>0)}}function J(n,l){1&n&&(t.TgZ(0,"div")(1,"h2",27),t._uU(2,"No hay Encuestas Buscadas... "),t.qZA()())}const A=[{path:"",component:(()=>{class n{constructor(e,s,a,o,u,g,m,f){var r=this;this.activatedRoute=e,this.baselocalService=s,this.toastController=a,this.router=o,this.authService=u,this.alertController=g,this.apiVisitArService=m,this.loadingController=f,this.btndisable=!1,this.searchText="",M.Z.addListener("networkStatusChange",function(){var h=(0,d.Z)(function*(p){r.verificoConectividad(p.connected)});return function(p){return h.apply(this,arguments)}}())}ionViewDidEnter(){var e=this;return(0,d.Z)(function*(){e.activatedRoute.paramMap.subscribe(function(){var s=(0,d.Z)(function*(a){e.id_Campania=Number(a.get("idCampania"))});return function(a){return s.apply(this,arguments)}}()),setTimeout(()=>{console.log("arranco"),e.getMisEncuestasLocal(),M.Z.getStatus().then(function(){var s=(0,d.Z)(function*(a){e.verificoConectividad(a.connected)});return function(a){return s.apply(this,arguments)}}())},500)})()}ngOnInit(){}getMisEncuestasLocal(){this.baselocalService.getArrayEncuestasForIdCam(this.id_Campania).then(e=>{this.misencuestasJson=e,this.filterCoints=this.misencuestasJson},e=>{console.log(e)})}verificoConectividad(e){var s=this;return(0,d.Z)(function*(){e?(console.log("Conectado Internet Get"),setTimeout(()=>{s.postEncuestasSinEnviar()},1500)):(console.log("Sin Internet Get"),s.baselocalService.getArrayEncuestas().then(o=>{},o=>{console.log(o)}),yield(yield s.toastController.create({message:"Sin conectividad",duration:4e3,cssClass:"custom-toast",buttons:[{text:"cerrar",role:"cancel"}]})).present())})()}presentAlert(e,s,a){var o=this;return(0,d.Z)(function*(){yield(yield o.alertController.create({backdropDismiss:!1,cssClass:"alertCustomCss",header:e,subHeader:s,message:a,buttons:["OK"],mode:"ios"})).present()})()}cerrar(){this.authService.logout(),this.router.navigate(["/login"])}nuevaEncuesta(){this.router.navigate(["home",{idCampania:this.id_Campania}])}postEncuestasSinEnviar(){var e=this;return(0,d.Z)(function*(){e.btndisable=!0,console.log("Intentando subir Encuestas sin enviar al servidor");const s=yield e.loadingController.create({message:"Intentando subir Encuestas sin enviar al servidor."});s.present();var a=e.misencuestasJson?.length,o=0;a>0?yield e.misencuestasJson.forEach(function(){var u=(0,d.Z)(function*(g,m){0==g.Enviado?(g.IdCampania_data<0&&(g.IdCampania_data=null),e.apiVisitArService.postEncuesta(g).subscribe(function(){var f=(0,d.Z)(function*(r){1==r.success?(e.misencuestasJson[m].Enviado=!0,e.misencuestasJson[m].IdCampania_data=r.idCampania_data,yield e.baselocalService.chageEnviadoIndexEncuestas(m)):(console.log(r.success),yield(yield e.toastController.create({message:r.message,duration:3e3,cssClass:"custom-toast",buttons:[{text:"cerrar",role:"cancel"}]})).present()),++o==a&&(console.log("Encuestas Subidad"),s.dismiss(),e.btndisable=!1,yield(yield e.toastController.create({message:"Encuestas Subidas al Servidor",duration:3e3,cssClass:"custom-toast",buttons:[{text:"cerrar",role:"cancel"}]})).present(),e.filterCoints=e.misencuestasJson)});return function(r){return f.apply(this,arguments)}}(),function(){var f=(0,d.Z)(function*(r){++o==a&&(console.log("Encuestas Subidas al Servidor"),s.dismiss(),e.btndisable=!1,yield(yield e.toastController.create({message:"Encuestas Subidas al Servidor",duration:3e3,cssClass:"custom-toast",buttons:[{text:"cerrar",role:"cancel"}]})).present()),console.log(r),yield(yield e.toastController.create({message:"Error al subir: "+JSON.stringify(r),duration:3e3,cssClass:"custom-toast",buttons:[{text:"cerrar",role:"cancel"}]})).present()});return function(r){return f.apply(this,arguments)}}())):++o==a&&(console.log("Encuestas Subidas al Servidor"),s.dismiss(),e.btndisable=!1,yield(yield e.toastController.create({message:"Encuestas Subidas al Servidor",duration:3e3,cssClass:"custom-toast",buttons:[{text:"cerrar",role:"cancel"}]})).present())});return function(g,m){return u.apply(this,arguments)}}()):(e.btndisable=!1,s.dismiss(),console.log("No hay encuestas guardadas o todas ya fueron subidas al servidor"))})()}getDistanciaMetros(e,s,a,o){var u=function(F){return F*Math.PI/180},m=u(a-e),f=u(o-s),r=Math.sin(m/2)*Math.sin(m/2)+Math.cos(u(e))*Math.cos(u(a))*Math.sin(f/2)*Math.sin(f/2);return 2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r))*6378.137*1e3}searchCoin(){this.filterCoints=this.misencuestasJson.filter(e=>e.Identificador.toLowerCase().includes(this.searchText.toLowerCase())||e.IdCampania_data==Number(this.searchText.toLowerCase()))}editarEncuesta(e){console.log(e),this.router.navigate(["home",{idCampania_data:e}])}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(_.gz),t.Y36(Z.c),t.Y36(i.yF),t.Y36(_.F0),t.Y36(y.e),t.Y36(i.Br),t.Y36(x.p),t.Y36(i.HT))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-misencuestas"]],decls:27,vars:7,consts:[[3,"translucent"],["color","primary"],["slot","start"],["defaultHref","campanias"],["mode","ios"],["slot","end"],["color","secondary",3,"click"],["slot","icon-only","name","log-out"],["mode","md",1,"ion-padding","gradient",3,"fullscreen"],["collapse","condense"],["size","large"],[1,"container"],["lines","full","detail",""],["color","secondary",2,"height","40px"],["type","text","placeholder","Buscar por Id, Identi",1,"text-center","border-0","text-light",2,"width","95%","text-align","center",3,"ngModel","ngModelChange","keyup"],[3,"click",4,"ngFor","ngForOf"],[4,"ngIf"],["horizontal","end","vertical","center","slot","fixed"],["color","danger",3,"disabled","click"],["name","add"],[3,"click"],["detail","","button","",4,"ngIf"],["detail","","button",""],["slot","start",4,"ngIf"],["text-wrap",""],["src","assets/imgs/close_icon.svg"],["src","assets/imgs/success_icon.svg"],["text-center",""]],template:function(e,s){1&e&&(t.TgZ(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-buttons",2),t._UZ(3,"ion-back-button",3),t.qZA(),t.TgZ(4,"ion-title",4),t._uU(5," VisitAR "),t.qZA(),t.TgZ(6,"ion-buttons",5)(7,"ion-button",6),t.NdJ("click",function(){return s.cerrar()}),t._UZ(8,"ion-icon",7),t.qZA()()()(),t.TgZ(9,"ion-content",8)(10,"ion-header",9)(11,"ion-toolbar")(12,"ion-title",10),t._uU(13,"VisitAR"),t.qZA()()(),t.TgZ(14,"div",11)(15,"ion-list",12)(16,"ion-item-divider",13)(17,"h3"),t._uU(18),t.qZA()(),t.TgZ(19,"p"),t._uU(20,'Si una encuesta tiene una "X" en rojo es por que aun no fue enviada al servidor.'),t.qZA(),t.TgZ(21,"input",14),t.NdJ("ngModelChange",function(o){return s.searchText=o})("keyup",function(){return s.searchCoin()}),t.qZA(),t.YNc(22,S,2,1,"div",15),t.YNc(23,J,3,0,"div",16),t.qZA()(),t.TgZ(24,"ion-fab",17)(25,"ion-fab-button",18),t.NdJ("click",function(){return s.nuevaEncuesta()}),t._UZ(26,"ion-icon",19),t.qZA()()()),2&e&&(t.Q6J("translucent",!0),t.xp6(9),t.Q6J("fullscreen",!0),t.xp6(9),t.hij("Mis Encuestas-Campa\xf1a Id: ",s.id_Campania,""),t.xp6(3),t.Q6J("ngModel",s.searchText),t.xp6(1),t.Q6J("ngForOf",s.filterCoints),t.xp6(1),t.Q6J("ngIf",(null==s.filterCoints?null:s.filterCoints.length)<=0),t.xp6(2),t.Q6J("disabled",s.btndisable))},dependencies:[C.sg,C.O5,v.Fj,v.JJ,v.On,i.oU,i.YG,i.Sm,i.W2,i.IJ,i.W4,i.Gu,i.gu,i.Ie,i.rH,i.Q$,i.q_,i.Bs,i.wd,i.sr,i.cs]}),n})()}];let P=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[_.Bz.forChild(A),_.Bz]}),n})(),N=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[C.ez,v.u5,i.Pc,P]}),n})()}}]);