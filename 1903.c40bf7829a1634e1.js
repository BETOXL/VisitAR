"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1903],{1903:(M,C,r)=>{r.r(C),r.d(C,{CampaniasPageModule:()=>F});var m=r(6895),Z=r(4719),i=r(1558),g=r(2905),l=r(5861),b=r(5670),n=r(6353),_=r(617),y=r(7556),A=r(1098);function x(e,c){if(1&e){const t=n.EpF();n.TgZ(0,"ion-buttons",17)(1,"ion-button",18),n.NdJ("click",function(){n.CHM(t);const o=n.oxw();return n.KtG(o.showInstallBanner())}),n._UZ(2,"ion-icon",19),n._uU(3," Instalar "),n.qZA()()}2&e&&(n.xp6(1),n.Q6J("replaceUrl",!0))}function P(e,c){if(1&e&&(n.TgZ(0,"ion-item",22)(1,"ion-thumbnail",17),n._UZ(2,"img",23),n.qZA(),n.TgZ(3,"ion-label",24)(4,"h3"),n._uU(5),n.qZA(),n.TgZ(6,"p"),n._uU(7),n.ALo(8,"date"),n.qZA()()()),2&e){const t=n.oxw().$implicit;n.xp6(5),n.lnq("Id:",null==t?null:t.Id," CAPS: ",null==t?null:t.CAPS," Nom: ",null==t?null:t.Nombre,""),n.xp6(2),n.AsE("",null==t?null:t.Descripcion," - Fecha Fin: ",n.xi3(8,5,null==t?null:t.FechaFin,"dd/MM/yy"),"")}}function J(e,c){if(1&e){const t=n.EpF();n.TgZ(0,"div",20),n.NdJ("click",function(){const s=n.CHM(t).$implicit,d=n.oxw();return n.KtG(d.enviarCampanias(null==s?null:s.Id))}),n.YNc(1,P,9,8,"ion-item",21),n.qZA()}if(2&e){const t=n.oxw();n.xp6(1),n.Q6J("ngIf",(null==t.campaniasJson?null:t.campaniasJson.campanias.length)>0)}}function T(e,c){1&e&&(n.TgZ(0,"div")(1,"h2",25),n._uU(2,"No hay campa\xf1as disponibles... "),n.qZA()())}const I=[{path:"",component:(()=>{class e{constructor(t,a,o,s,d,f,v){var p=this;this.baselocalService=t,this.toastController=a,this.router=o,this.authService=s,this.alertController=d,this.apiVisitArService=f,this.loadingController=v,this.btndisableOffline=!1,this.campaniasJson={campanias:""},b.Z.addListener("networkStatusChange",function(){var u=(0,l.Z)(function*(h){p.verificoConectividad(h.connected)});return function(h){return u.apply(this,arguments)}}())}ngOnInit(){}ionViewWillEnter(){var t=this;return(0,l.Z)(function*(){window.addEventListener("beforeinstallprompt",a=>{console.log("beforeinstallprompt Event fired"),a.preventDefault(),t.deferredPrompt=a})})()}ionViewDidEnter(){var t=this;return(0,l.Z)(function*(){t.baselocalService.getArrayCampanias().then(a=>{t.campaniasJson.campanias=a,t.campaniasJson.campanias=t.campaniasJson.campanias.sort((o,s)=>s.Id-o.Id)},a=>{console.log(a)}),b.Z.getStatus().then(function(){var a=(0,l.Z)(function*(o){t.verificoConectividad(o.connected)});return function(o){return a.apply(this,arguments)}}())})()}showInstallBanner(){null!=this.deferredPrompt&&(this.deferredPrompt.prompt(),this.deferredPrompt.userChoice.then(t=>{"accepted"===t.outcome?console.log("User accepted the A2HS prompt"):console.log("User dismissed the A2HS prompt"),this.deferredPrompt=null}))}verificoConectividad(t){var a=this;return(0,l.Z)(function*(){t?(console.log("Conectado Internet Get"),a.btndisableOffline=!1,setTimeout(()=>{a.getCampanias()},1500)):(console.log("Sin Internet Get"),a.btndisableOffline=!0,yield(yield a.toastController.create({message:"Sin conectividad",duration:4e3,cssClass:"custom-toast",buttons:[{text:"cerrar",role:"cancel"}]})).present())})()}getCampanias(){var t=this;return(0,l.Z)(function*(){console.log("Obtengo Rondas");const a=yield t.loadingController.create({message:"Aguarde pidiendo campa\xf1as..."});a.present(),t.apiVisitArService.getCampanias().subscribe(o=>{a.dismiss(),t.campaniasJson=o,console.log(t.campaniasJson),t.campaniasJson.campanias=t.campaniasJson.campanias.sort((s,d)=>d.Id-s.Id),setTimeout(()=>{t.getModelosEncuentas()},500),t.baselocalService.setArrayCampanias(t.campaniasJson.campanias)},o=>{a.dismiss(),t.presentAlert("Info","Problema",o.message+" "+JSON.stringify(o.error)),console.log(o)})})()}presentAlert(t,a,o){var s=this;return(0,l.Z)(function*(){yield(yield s.alertController.create({backdropDismiss:!1,cssClass:"alertCustomCss",header:t,subHeader:a,message:o,buttons:["OK"],mode:"ios"})).present()})()}cerrar(){this.authService.logout(),this.router.navigate(["/login"])}enviarCampanias(t){this.router.navigate(["misencuestas",{idCampania:t}])}getModelosEncuentas(){var t=this;return(0,l.Z)(function*(){console.log("Obtengo Modelos");const a=yield t.loadingController.create({message:"Aguarde pidiendo modelos..."});a.present();var o=t.campaniasJson.campanias.length,s=0;yield t.campaniasJson.campanias.forEach(function(){var d=(0,l.Z)(function*(f,v){t.apiVisitArService.getEncuestaModelo(f.Id).subscribe(function(){var p=(0,l.Z)(function*(u){s++,t.baselocalService.setArrayModelo(u),console.log("Modelo ",s),s==o&&(console.log("Finaliza bajada de modelos"),a.dismiss(),yield(yield t.toastController.create({message:"Descarga Completo",duration:3e3,cssClass:"custom-toast",buttons:[{text:"cerrar",role:"cancel"}]})).present())});return function(u){return p.apply(this,arguments)}}(),function(){var p=(0,l.Z)(function*(u){++s==o&&(console.log("Finaliza bajada de modelos"),a.dismiss(),yield(yield t.toastController.create({message:"Descarga Completo",duration:3e3,cssClass:"custom-toast",buttons:[{text:"cerrar",role:"cancel"}]})).present()),console.log(u)});return function(u){return p.apply(this,arguments)}}())});return function(f,v){return d.apply(this,arguments)}}())})()}}return e.\u0275fac=function(t){return new(t||e)(n.Y36(_.c),n.Y36(i.yF),n.Y36(g.F0),n.Y36(y.e),n.Y36(i.Br),n.Y36(A.p),n.Y36(i.HT))},e.\u0275cmp=n.Xpm({type:e,selectors:[["app-campanias"]],decls:23,vars:6,consts:[[3,"translucent"],["color","primary"],["slot","start",4,"ngIf"],["mode","ios"],["slot","end"],["color","secondary",3,"disabled","click"],["slot","icon-only","name","log-out"],["mode","md",1,"ion-padding","gradient",3,"fullscreen"],["collapse","condense"],["size","large"],[1,"container"],["lines","full","detail",""],["color","secondary",2,"height","40px"],[3,"click",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"footer-button"],["expand","block","shape","round",3,"click"],["slot","start"],["color","success","routerLink","/browse",3,"replaceUrl","click"],["slot","start","name","archive-outline"],[3,"click"],["detail","","button","",4,"ngIf"],["detail","","button",""],["src","assets/imgs/campaign_icon.svg"],["text-wrap","",1,"notranslate"],["text-center",""]],template:function(t,a){1&t&&(n.TgZ(0,"ion-header",0)(1,"ion-toolbar",1),n.YNc(2,x,4,1,"ion-buttons",2),n.TgZ(3,"ion-title",3),n._uU(4," VisitAR Alpha1.0 "),n.qZA(),n.TgZ(5,"ion-buttons",4)(6,"ion-button",5),n.NdJ("click",function(){return a.cerrar()}),n._UZ(7,"ion-icon",6),n.qZA()()()(),n.TgZ(8,"ion-content",7)(9,"ion-header",8)(10,"ion-toolbar")(11,"ion-title",9),n._uU(12,"VisitAR Alpha1.0"),n.qZA()()(),n.TgZ(13,"div",10)(14,"ion-list",11)(15,"ion-item-divider",12)(16,"h3"),n._uU(17,"Rondas Sanitarias"),n.qZA()(),n.YNc(18,J,2,1,"div",13),n.YNc(19,T,3,0,"div",14),n.qZA(),n.TgZ(20,"div",15)(21,"ion-button",16),n.NdJ("click",function(){return a.getCampanias()}),n._uU(22," Bajar Rondas "),n.qZA()()()()),2&t&&(n.Q6J("translucent",!0),n.xp6(2),n.Q6J("ngIf",a.deferredPrompt),n.xp6(4),n.Q6J("disabled",a.btndisableOffline),n.xp6(2),n.Q6J("fullscreen",!0),n.xp6(10),n.Q6J("ngForOf",null==a.campaniasJson?null:a.campaniasJson.campanias),n.xp6(1),n.Q6J("ngIf",(null==a.campaniasJson?null:a.campaniasJson.campanias.length)<=0))},dependencies:[m.sg,m.O5,i.YG,i.Sm,i.W2,i.Gu,i.gu,i.Ie,i.rH,i.Q$,i.q_,i.Bs,i.wd,i.sr,i.YI,g.rH,m.uU],styles:["ion-button[_ngcontent-%COMP%]{--background: linear-gradient(135deg, var(--ion-color-success) 0%, var(--ion-color-tertiary) 100%)!important;--padding-top: 25px!important;--padding-bottom: 25px!important;margin-bottom:12px!important;--color: #fff!important;font-weight:700;font-size:1.1em;text-transform:inherit!important;--box-shadow: none!important}.deshabilitado[_ngcontent-%COMP%]{--background: linear-gradient(135deg, #D9DCDF 0%, #F6F7FB 100%)!important}"]}),e})()}];let S=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=n.oAB({type:e}),e.\u0275inj=n.cJS({imports:[g.Bz.forChild(I),g.Bz]}),e})(),F=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=n.oAB({type:e}),e.\u0275inj=n.cJS({imports:[m.ez,Z.u5,i.Pc,S]}),e})()}}]);