"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4948],{4948:(F,C,l)=>{l.r(C),l.d(C,{MisencuestasPageModule:()=>Y});var _=l(6895),v=l(4719),o=l(1558),b=l(2905),d=l(5861),M=l(5670),e=l(6353),y=l(617),x=l(7556),E=l(1098);function T(n,c){1&n&&(e.TgZ(0,"ion-thumbnail",2),e._UZ(1,"img",25),e.qZA())}function I(n,c){1&n&&(e.TgZ(0,"ion-thumbnail",2),e._UZ(1,"img",26),e.qZA())}function S(n,c){if(1&n&&(e.TgZ(0,"ion-item",22),e.YNc(1,T,2,0,"ion-thumbnail",23),e.YNc(2,I,2,0,"ion-thumbnail",23),e.TgZ(3,"ion-label",24)(4,"h3"),e._uU(5),e.qZA(),e.TgZ(6,"p"),e._uU(7),e.qZA()()()),2&n){const t=e.oxw(),s=t.$implicit,a=t.index,i=e.oxw();e.Q6J("disabled",i.listdisable),e.xp6(1),e.Q6J("ngIf",!(null!=s&&s.Enviado)),e.xp6(1),e.Q6J("ngIf",null==s?null:s.Enviado),e.xp6(3),e.lnq("N",a," Id:",null==s?null:s.IdCampania_data," - Identi: ",null==s?null:s.Identificador,""),e.xp6(2),e.AsE("",null==s?null:s.Descripcion," - Fecha: ",null==s?null:s.Fecha,"")}}function J(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"div",20),e.NdJ("click",function(){const i=e.CHM(t).$implicit,u=e.oxw();return e.KtG(u.editarEncuesta(i.IdCampania_data))}),e.YNc(1,S,8,8,"ion-item",21),e.qZA()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",(null==t.filterCoints?null:t.filterCoints.length)>0)}}function A(n,c){1&n&&(e.TgZ(0,"div")(1,"h2",27),e._uU(2,"No hay Encuestas Buscadas... "),e.qZA()())}const P=[{path:"",component:(()=>{class n{constructor(t,s,a,i,u,g,f,h){var m=this;this.activatedRoute=t,this.baselocalService=s,this.toastController=a,this.router=i,this.authService=u,this.alertController=g,this.apiVisitArService=f,this.loadingController=h,this.btndisable=!1,this.searchText="",this.listdisable=!1,M.Z.addListener("networkStatusChange",function(){var r=(0,d.Z)(function*(p){m.verificoConectividad(p.connected)});return function(p){return r.apply(this,arguments)}}())}ionViewDidEnter(){var t=this;return(0,d.Z)(function*(){t.activatedRoute.paramMap.subscribe(function(){var s=(0,d.Z)(function*(a){t.id_Campania=Number(a.get("idCampania"))});return function(a){return s.apply(this,arguments)}}()),setTimeout(()=>{console.log("arranco"),t.getMisEncuestasLocal(),M.Z.getStatus().then(function(){var s=(0,d.Z)(function*(a){t.verificoConectividad(a.connected)});return function(a){return s.apply(this,arguments)}}())},500)})()}ngOnInit(){}getMisEncuestasLocal(){this.baselocalService.getArrayEncuestasForIdCam(this.id_Campania).then(t=>{this.misencuestasJson=t,this.filterCoints=this.misencuestasJson},t=>{console.log(t)})}verificoConectividad(t){var s=this;return(0,d.Z)(function*(){t?(console.log("Conectado Internet Get"),setTimeout(()=>{s.postEncuestasSinEnviar()},1500)):(console.log("Sin Internet Get"),s.baselocalService.getArrayEncuestas().then(i=>{},i=>{console.log(i)}),yield(yield s.toastController.create({message:"Sin conectividad",duration:4e3,cssClass:"custom-toast",buttons:[{text:"cerrar",role:"cancel"}]})).present())})()}presentAlert(t,s,a){var i=this;return(0,d.Z)(function*(){yield(yield i.alertController.create({backdropDismiss:!1,cssClass:"alertCustomCss",header:t,subHeader:s,message:a,buttons:["OK"],mode:"ios"})).present()})()}cerrar(){this.authService.logout(),this.router.navigate(["/login"])}nuevaEncuesta(){this.router.navigate(["home",{idCampania:this.id_Campania}])}postEncuestasSinEnviar(){var t=this;return(0,d.Z)(function*(){t.btndisable=!0,t.listdisable=!0,console.log("Intentando subir Encuestas sin enviar al servidor");const s=yield t.loadingController.create({message:"Intentando subir Encuestas sin enviar al servidor."});s.present();var a=t.misencuestasJson?.length,i=0;a>0?yield t.misencuestasJson.forEach(function(){var u=(0,d.Z)(function*(g,f){if(0==g.Enviado){let h=g.IdCampania_data;g.IdCampania_data<0&&(g.IdCampania_data=null),t.apiVisitArService.postEncuesta(g).subscribe(function(){var m=(0,d.Z)(function*(r){1==r.success?(t.misencuestasJson[f].Enviado=!0,yield t.baselocalService.chageEnviadoIndexEncuestas(h,Number(r.idCampania_data)),t.misencuestasJson[f].IdCampania_data=r.idCampania_data):(console.log(r.success),yield(yield t.toastController.create({message:r.message,duration:3e3,cssClass:"custom-toast",buttons:[{text:"cerrar",role:"cancel"}]})).present()),++i==a&&(console.log("Encuestas Subidad"),s.dismiss(),t.btndisable=!1,t.listdisable=!1,yield(yield t.toastController.create({message:"Encuestas Subidas al Servidor",duration:3e3,cssClass:"custom-toast",buttons:[{text:"cerrar",role:"cancel"}]})).present(),t.filterCoints=t.misencuestasJson)});return function(r){return m.apply(this,arguments)}}(),function(){var m=(0,d.Z)(function*(r){++i==a&&(console.log("Encuestas Subidas al Servidor"),s.dismiss(),t.btndisable=!1,t.listdisable=!1,yield(yield t.toastController.create({message:"Encuestas Subidas al Servidor",duration:3e3,cssClass:"custom-toast",buttons:[{text:"cerrar",role:"cancel"}]})).present()),console.log(r),yield(yield t.toastController.create({message:"Error al subir: "+JSON.stringify(r),duration:3e3,cssClass:"custom-toast",buttons:[{text:"cerrar",role:"cancel"}]})).present()});return function(r){return m.apply(this,arguments)}}())}else++i==a&&(console.log("Encuestas Subidas al Servidor"),s.dismiss(),t.btndisable=!1,t.listdisable=!1,yield(yield t.toastController.create({message:"Encuestas Subidas al Servidor",duration:3e3,cssClass:"custom-toast",buttons:[{text:"cerrar",role:"cancel"}]})).present())});return function(g,f){return u.apply(this,arguments)}}()):(t.btndisable=!1,t.listdisable=!1,s.dismiss(),console.log("No hay encuestas guardadas o todas ya fueron subidas al servidor"))})()}getDistanciaMetros(t,s,a,i){var u=function(Z){return Z*Math.PI/180},f=u(a-t),h=u(i-s),m=Math.sin(f/2)*Math.sin(f/2)+Math.cos(u(t))*Math.cos(u(a))*Math.sin(h/2)*Math.sin(h/2);return 2*Math.atan2(Math.sqrt(m),Math.sqrt(1-m))*6378.137*1e3}searchCoin(){this.filterCoints=this.misencuestasJson.filter(t=>t.Identificador.toLowerCase().includes(this.searchText.toLowerCase())||t.IdCampania_data==Number(this.searchText.toLowerCase()))}editarEncuesta(t){console.log(t),this.router.navigate(["home",{idCampania_data:t}])}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(b.gz),e.Y36(y.c),e.Y36(o.yF),e.Y36(b.F0),e.Y36(x.e),e.Y36(o.Br),e.Y36(E.p),e.Y36(o.HT))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-misencuestas"]],decls:27,vars:7,consts:[[3,"translucent"],["color","primary"],["slot","start"],["defaultHref","campanias"],["mode","ios"],["slot","end"],["color","secondary",3,"click"],["slot","icon-only","name","log-out"],["mode","md",1,"ion-padding","gradient",3,"fullscreen"],["collapse","condense"],["size","large"],[1,"container"],["lines","full","detail",""],["color","secondary",2,"height","40px"],["type","text","placeholder","Buscar por Id, Identi",1,"text-center","border-0","text-light",2,"width","95%","text-align","center",3,"ngModel","ngModelChange","keyup"],[3,"click",4,"ngFor","ngForOf"],[4,"ngIf"],["horizontal","end","vertical","center","slot","fixed"],["color","danger",3,"disabled","click"],["name","add"],[3,"click"],["detail","","button","",3,"disabled",4,"ngIf"],["detail","","button","",3,"disabled"],["slot","start",4,"ngIf"],["text-wrap",""],["src","assets/imgs/close_icon.svg"],["src","assets/imgs/success_icon.svg"],["text-center",""]],template:function(t,s){1&t&&(e.TgZ(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-buttons",2),e._UZ(3,"ion-back-button",3),e.qZA(),e.TgZ(4,"ion-title",4),e._uU(5," VisitAR Alpha0.5 "),e.qZA(),e.TgZ(6,"ion-buttons",5)(7,"ion-button",6),e.NdJ("click",function(){return s.cerrar()}),e._UZ(8,"ion-icon",7),e.qZA()()()(),e.TgZ(9,"ion-content",8)(10,"ion-header",9)(11,"ion-toolbar")(12,"ion-title",10),e._uU(13,"VisitAR Alpha0.5"),e.qZA()()(),e.TgZ(14,"div",11)(15,"ion-list",12)(16,"ion-item-divider",13)(17,"h3"),e._uU(18),e.qZA()(),e.TgZ(19,"p"),e._uU(20,'Si una encuesta tiene una "X" en rojo es por que aun no fue enviada al servidor.'),e.qZA(),e.TgZ(21,"input",14),e.NdJ("ngModelChange",function(i){return s.searchText=i})("keyup",function(){return s.searchCoin()}),e.qZA(),e.YNc(22,J,2,1,"div",15),e.YNc(23,A,3,0,"div",16),e.qZA()(),e.TgZ(24,"ion-fab",17)(25,"ion-fab-button",18),e.NdJ("click",function(){return s.nuevaEncuesta()}),e._UZ(26,"ion-icon",19),e.qZA()()()),2&t&&(e.Q6J("translucent",!0),e.xp6(9),e.Q6J("fullscreen",!0),e.xp6(9),e.hij("Mis Encuestas-Ronda Id: ",s.id_Campania,""),e.xp6(3),e.Q6J("ngModel",s.searchText),e.xp6(1),e.Q6J("ngForOf",s.filterCoints),e.xp6(1),e.Q6J("ngIf",(null==s.filterCoints?null:s.filterCoints.length)<=0),e.xp6(2),e.Q6J("disabled",s.btndisable))},dependencies:[_.sg,_.O5,v.Fj,v.JJ,v.On,o.oU,o.YG,o.Sm,o.W2,o.IJ,o.W4,o.Gu,o.gu,o.Ie,o.rH,o.Q$,o.q_,o.Bs,o.wd,o.sr,o.cs]}),n})()}];let N=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[b.Bz.forChild(P),b.Bz]}),n})(),Y=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[_.ez,v.u5,o.Pc,N]}),n})()}}]);